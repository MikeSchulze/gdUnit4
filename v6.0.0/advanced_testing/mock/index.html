<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/gdUnit4/v6.0.0/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/gdUnit4/v6.0.0/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul:nth-of-type(5) > li > a, .site-nav > ul:nth-of-type(5) > li > ul > li:not(:nth-child(6)) > a, .site-nav > ul:nth-of-type(5) > li > ul > li > ul > li a { background-image: none; } .site-nav > ul:not(:nth-of-type(5)) a, .site-nav li.external a { background-image: none; } .site-nav > ul:nth-of-type(5) > li:nth-child(1) > ul > li:nth-child(6) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul:nth-of-type(5) > li:nth-child(1) > button svg, .site-nav > ul:nth-of-type(5) > li:nth-child(1) > ul > li:nth-child(6) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul:nth-of-type(5) > li.nav-list-item:nth-child(1) > ul.nav-list, .site-nav > ul:nth-of-type(5) > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(6) > ul.nav-list { display: block; } </style> <script src="/gdUnit4/v6.0.0/assets/js/vendor/lunr.min.js"></script> <script src="/gdUnit4/v6.0.0/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Mocking | GdUnit4</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Mocking" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Mocking / Mocks" /> <meta property="og:description" content="Mocking / Mocks" /> <meta property="og:site_name" content="GdUnit4" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2025-10-31T11:50:12+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Mocking" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-10-31T11:50:12+00:00","datePublished":"2025-10-31T11:50:12+00:00","description":"Mocking / Mocks","headline":"Mocking","mainEntityOfPage":{"@type":"WebPage","@id":"/gdUnit4/v6.0.0/advanced_testing/mock/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/gdUnit4/v6.0.0/assets/images/logo.png"}},"url":"/gdUnit4/v6.0.0/advanced_testing/mock/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/gdUnit4/v6.0.0/" class="site-title lh-tight"><div class="site-logo"> </div> GdUnit4 </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/" class="nav-list-link">About</a></li></ul> <div class="nav-category">First Steps</div> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/first_steps/install/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/first_steps/settings/" class="nav-list-link">Settings</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/first_steps/run-tests/" class="nav-list-link">Run Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/first_steps/getting-started/" class="nav-list-link">Getting Started</a></li></ul> <div class="nav-category">C# Project Setup</div> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/csharp_project_setup/csharp-setup/" class="nav-list-link">Setup/Installation</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/csharp_project_setup/vstest-adapter/" class="nav-list-link">Configure Your IDE</a></li></ul> <div class="nav-category">Testing</div> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/unit-testing/" class="nav-list-link">Unit Testing</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/integration-testing/" class="nav-list-link">Integration Testing</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/test-suite/" class="nav-list-link">Test Suite</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/test-case/" class="nav-list-link">Test Case</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/hooks/" class="nav-list-link">Hooks</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Asserts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gdUnit4/v6.0.0/testing/assert/" class="nav-list-link">Asserts</a><ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-that/" class="nav-list-link">AssertThat</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-array/" class="nav-list-link">Array Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-bool/" class="nav-list-link">Boolean Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-dictionary/" class="nav-list-link">Dictionary Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-error/" class="nav-list-link">Error/Exception Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-file/" class="nav-list-link">File Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-float/" class="nav-list-link">Float/Double Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-function/" class="nav-list-link">Function/Method Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-integer/" class="nav-list-link">Integer Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-number/" class="nav-list-link">Number Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-object/" class="nav-list-link">Object Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-signal/" class="nav-list-link">Signal Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-string/" class="nav-list-link">String Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/testing/assert-vector/" class="nav-list-link">Vector Assert</a></li></ul></li></ul> <div class="nav-category"></div> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced Testing category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gdUnit4/v6.0.0/advanced_testing/index/" class="nav-list-link">Advanced Testing</a><ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/tools/" class="nav-list-link">Tools and Helpers</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/hooks/" class="nav-list-link">Session Hooks</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/fuzzing/" class="nav-list-link">Fuzzing</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/paramerized_tests/" class="nav-list-link">Parameterized Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/signals/" class="nav-list-link">Signals</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/mock/" class="nav-list-link">Mocking</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/spy/" class="nav-list-link">Spying</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/argument_matchers/" class="nav-list-link">Argument Matchers</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Scene Runner category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gdUnit4/v6.0.0/advanced_testing/sceneRunner/" class="nav-list-link">Scene Runner</a><ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/scene_runner/actions/" class="nav-list-link">Actions</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/scene_runner/keys/" class="nav-list-link">Key Inputs</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/scene_runner/mouse/" class="nav-list-link">Mouse Inputs</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/scene_runner/touchscreen/" class="nav-list-link">Touchscreen Inputs</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/scene_runner/sync_inputs/" class="nav-list-link">Synchronize Inputs</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/scene_runner/signals/" class="nav-list-link">Signals</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/scene_runner/functions/" class="nav-list-link">Functions</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/scene_runner/accessors/" class="nav-list-link">Accessors</a></li></ul></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/skip-tests/" class="nav-list-link">Skip Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/flaky-tests/" class="nav-list-link">Flaky Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/orphan/" class="nav-list-link">Orphan Nodes</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/cmd/" class="nav-list-link">Command Line Tool</a></li></ul></li></ul> <div class="nav-category"></div> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Tutorials category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gdUnit4/v6.0.0/tutorials/index/" class="nav-list-link">Tutorials</a><ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/tutorials/tdd/" class="nav-list-link">Test Driven Development</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/tutorials/scenerunner_examples/" class="nav-list-link">Testing Scene Interactions</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/tutorials/tutorial_basics/" class="nav-list-link">Basics</a></li></ul></li></ul> <div class="nav-category">FAQ</div> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/faq/ci/" class="nav-list-link">Continuous Integration Testing</a></li><li class="nav-list-item"><a href="/gdUnit4/v6.0.0/faq/solutions/" class="nav-list-link">Problems & Solutions</a></li></ul> </nav> <!-- _includes/nav_footer_custom.html --> <footer class="site-footer"> <div class="version-switcher"> <label>Version:</label> <div class="version-selector"> <select onchange="location = this.value;"> <option value="/gdUnit4/latest/" class="version-dropdown-item" > latest </option> <option value="/gdUnit4/v6.0.0/" class="version-dropdown-item" selected> v6.0.0 </option> <option value="/gdUnit4/v5.1.1/" class="version-dropdown-item" > v5.1.1 </option> </select> </div> </div> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search GdUnit4" aria-label="Search GdUnit4" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/MikeSchulze/gdUnit4" class="site-button" target="_blank" rel="noopener noreferrer" > GdUnit4 on GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/gdUnit4/v6.0.0/advanced_testing/index/">Advanced Testing</a></li> <li class="breadcrumb-nav-list-item"><span>Mocking</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="mocking--mocks"> <a href="#mocking--mocks" class="anchor-heading" aria-labelledby="mocking--mocks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mocking / Mocks </h1> <div class="advice-header"> <img style="vertical-align:middle;" src="/gdUnit4/v6.0.0\assets\images\icons\info-32x32.png" /> <span>Advice</span> <div class="advice-content"> This Mocking implementation is only available for GDScripts, for C# you can use already existing mocking frameworks like <a href="https://github.com/devlooped/moq" target="_blank"><b>Moq</b></a> </div> </div> <h2 id="definition"> <a href="#definition" class="anchor-heading" aria-labelledby="definition"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Definition </h2> <p>A mocked object is a dummy implementation of a class, in which you define the expected output of certain function calls. Mocked objects are configured to perform a specific behavior during testing, and they track all function calls and their parameters to the mocked object.</p> <p>This type of testing is sometimes referred to as behavior testing. Behavior testing does not check the result of a function call, but instead checks that a function is called with the correct parameters.</p> <p>For more detailed information about mocks, <a href="https://en.wikipedia.org/wiki/Mock_object" target="_blank">read this</a></p><hr /> <p>Here an small example to mock the class <code class="language-plaintext highlighter-rouge">TestClass</code>:</p> <ul id="mock-example" class="tab" data-tab="e287ed19-f96d-400c-b841-24773ffa7293" data-name="mock-example"> <li class="active" id="mock-example-example-class"> <a href="#">Example Class </a> </li> <li id="mock-example-mock--return-defaults-"> <a href="#">Mock (RETURN_DEFAULTS) </a> </li> <li id="mock-example-mock--call-real-func-"> <a href="#">Mock (CALL_REAL_FUNC) </a> </li> </ul> <ul class="tab-content" id="e287ed19-f96d-400c-b841-24773ffa7293" data-name="mock-example"> <li class="active"> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class_name</span> <span class="n">TestClass</span>
<span class="k">extends</span> <span class="n">Node</span>

    <span class="k">func</span> <span class="nf">message</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">"a message"</span>
</code></pre></div></div> </li> <li> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="nf">test_mock</span><span class="p">():</span>
    <span class="c1"># create a mock for class 'TestClass' by mock mode `RETURN_DEFAULTS` (default)</span>
    <span class="k">var</span> <span class="n">mock</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">TestClass</span><span class="p">)</span> <span class="k">as</span> <span class="n">TestClass</span>

    <span class="c1"># inital the mock will return a default value, for string means an empty string</span>
    <span class="n">assert_str</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">message</span><span class="p">())</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span>

    <span class="c1"># new we override the return value for `message()` to return 'custom message'</span>
    <span class="n">do_return</span><span class="p">(</span><span class="s2">"custom message"</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">mock</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="p">()</span>

    <span class="c1"># the next call of `message()` will now return 'custom message'</span>
    <span class="n">assert_str</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">message</span><span class="p">())</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="s2">"custom message"</span><span class="p">)</span>
</code></pre></div></div> </li> <li> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="nf">test_mock</span><span class="p">():</span>
    <span class="c1"># create a mock for class 'TestClass' using mode `CALL_REAL_FUNC`</span>
    <span class="k">var</span> <span class="n">mock</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">TestClass</span><span class="p">,</span> <span class="n">CALL_REAL_FUNC</span><span class="p">)</span> <span class="k">as</span> <span class="n">TestClass</span>

    <span class="c1"># inital the mock will return a original value (calles the real implementation)</span>
    <span class="n">assert_str</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">message</span><span class="p">())</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="s2">"a message"</span><span class="p">)</span>

    <span class="c1"># new we override the return value for `message()` to return 'custom message'</span>
    <span class="n">do_return</span><span class="p">(</span><span class="s2">"custom message"</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">mock</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="p">()</span>

    <span class="c1"># the next call of `message()` will now return 'custom message'</span>
    <span class="n">assert_str</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">message</span><span class="p">())</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="s2">"custom message"</span><span class="p">)</span>
</code></pre></div></div> </li> </ul><hr /> <h2 id="how-to-use-a-mock"> <a href="#how-to-use-a-mock" class="anchor-heading" aria-labelledby="how-to-use-a-mock"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How to use a Mock </h2> <div class="advice-header"> <img style="vertical-align:middle;" src="/gdUnit4/v6.0.0\assets\images\icons\info-32x32.png" /> <span>Advice</span> <div class="advice-content"> Mocking core functions are not possible since Godot has improved the GDScript performance.<br /> According to the Godot core developers, overwriting core functions is no longer supported, so there is no way to mock or spy on core functions anymore. </div> </div> <p>To mock a class, you only need to use <strong>mock(&lt;class_name&gt;)</strong> or <strong>mock(&lt;resource_path&gt;)</strong> to create a mocked object instance using the given class name or path. A mocked instance is marked for auto-free, so you don’t need to free it manually.</p> <p>If you want to create a mock by class name, you have to define the class_name in your class. Otherwise, the class must be mocked by resource path.</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Example class</span>
<span class="k">class_name</span> <span class="n">TestClass</span>
<span class="k">extends</span> <span class="n">Node</span>
    <span class="o">...</span>
</code></pre></div></div> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a mocked instance of the class 'TestClass'</span>
<span class="k">var</span> <span class="n">mock</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">TestClass</span><span class="p">)</span>
<span class="c1"># Or create it by using the full resource path if no `class_name` is defined</span>
<span class="k">var</span> <span class="n">mock</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="s2">"res://project_name/src/TestClass.gd"</span><span class="p">)</span>
</code></pre></div></div> <p>You can also mock inner classes by using <strong>mock(&lt;class_name&gt;)</strong> with some preconditions.</p> <h2 id="how-and-why-to-overwrite-functions"> <a href="#how-and-why-to-overwrite-functions" class="anchor-heading" aria-labelledby="how-and-why-to-overwrite-functions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How and Why to Overwrite Functions </h2> <p>With a mock, you can override a specific function to return custom values. This allows you to simulate a function and return an expected value without calling the actual implementation.</p> <p>To override a function on your mocked class, use <strong>do_return(&lt;value&gt;)</strong> to specify the return value.</p> <p><b>Syntax</b> <code class="language-plaintext highlighter-rouge">do_return(&lt;value&gt;)</code> <code class="language-plaintext highlighter-rouge">.on(&lt;mock&gt;)</code> <code class="language-plaintext highlighter-rouge">.&lt;function([args])&gt;)</code></p> <ol> <li>Mock your class.</li> <li>Define the return value.</li> <li>Override the function you want to mock using .on(<mock>) and .function_name([args]).</mock></li> </ol> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create the mock</span>
<span class="k">var</span> <span class="n">node</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span> <span class="k">as</span> <span class="n">Node</span>
<span class="c1"># Define the return value on the mock `node` for function `get_name` </span>
<span class="n">do_return</span><span class="p">(</span><span class="s2">"NodeX"</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</code></pre></div></div> <p>Here is an example:</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a mock from class `Node`</span>
<span class="k">var</span> <span class="n">mocked_node</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span> <span class="k">as</span> <span class="n">Node</span>

<span class="c1"># It returns 0 by default</span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">get_child_count</span><span class="p">()</span>
<span class="c1"># Override function `get_child_count` to return 10</span>
<span class="n">do_return</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span><span class="o">.</span><span class="n">get_child_count</span><span class="p">()</span>
<span class="c1"># The next call of `get_child_count` will now return 10</span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">get_child_count</span><span class="p">()</span>

<span class="c1"># It returns 'null' by default</span>
<span class="k">var</span> <span class="n">node</span> <span class="o">=</span> <span class="n">mocked_node</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">assert_object</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span>

<span class="c1"># Override function `get_child` to return a mocked 'Camera' for child index 0</span>
<span class="n">do_return</span><span class="p">(</span><span class="n">mock</span><span class="p">(</span><span class="n">Camera</span><span class="p">))</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># And a mocked 'Area' for child index 1</span>
<span class="n">do_return</span><span class="p">(</span><span class="n">mock</span><span class="p">(</span><span class="n">Area</span><span class="p">))</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># It now returns the Camera node at index 0</span>
<span class="k">var</span> <span class="n">node0</span> <span class="o">=</span> <span class="n">mocked_node</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">assert_object</span><span class="p">(</span><span class="n">node0</span><span class="p">)</span><span class="o">.</span><span class="n">is_instanceof</span><span class="p">(</span><span class="n">Camera</span><span class="p">)</span>
<span class="c1"># And the Area node at index 1</span>
<span class="k">var</span> <span class="n">node1</span> <span class="o">=</span> <span class="n">mocked_node</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">assert_object</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span><span class="o">.</span><span class="n">is_instanceof</span><span class="p">(</span><span class="n">Area</span><span class="p">)</span>
</code></pre></div></div><hr /> <h2 id="verification-of-function-calls"> <a href="#verification-of-function-calls" class="anchor-heading" aria-labelledby="verification-of-function-calls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Verification of Function Calls </h2> <p>A mock keeps track of all the function calls and their arguments. Use <strong>verify()</strong> on the mock to check if a certain function is called and how often it was called.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Function</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><a href="/gdUnit4/v6.0.0/advanced_testing/mock/#verify">verify</a></td> <td>Verifies that certain behavior happened at least once or an exact number of times.</td> </tr> <tr> <td><a href="/gdUnit4/v6.0.0/advanced_testing/mock/#verify_no_interactions">verify_no_interactions</a></td> <td>Verifies that no interactions happened on the mock.</td> </tr> <tr> <td><a href="/gdUnit4/v6.0.0/advanced_testing/mock/#verify_no_more_interactions">verify_no_more_interactions</a></td> <td>Verifies that the given mock has no unverified interactions.</td> </tr> <tr> <td><a href="/gdUnit4/v6.0.0/advanced_testing/mock/#reset">reset</a></td> <td>Resets the saved function call counters on a mock.</td> </tr> </tbody> </table></div> <h3 id="verify"> <a href="#verify" class="anchor-heading" aria-labelledby="verify"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> verify </h3> <p>The verify() method is used to verify that a function was called a certain number of times. It takes two arguments: the mock instance and the expected number of times the function should have been called. You can also use argument matchers to verify that specific arguments were passed to the function.</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">verify</span><span class="p">(</span><span class="o">&lt;</span><span class="n">mock</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">times</span><span class="o">&gt;</span><span class="p">)</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">&lt;</span><span class="n">args</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div> <p>Here’s an example:</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">mocked_node</span> <span class="p">:</span><span class="n">Node</span> <span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span>

<span class="c1"># Verify we have no interactions currently on this instance</span>
<span class="n">verify_no_interactions</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span>

<span class="c1"># Call with different arguments</span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">false</span><span class="p">)</span> <span class="c1"># 1 times</span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">true</span><span class="p">)</span> <span class="c1"># 1 times</span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">true</span><span class="p">)</span> <span class="c1"># 2 times</span>

<span class="c1"># Verify how often we called the function with different argument </span>
<span class="n">verify</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">false</span><span class="p">)</span><span class="c1"># in sum one time with false</span>
<span class="n">verify</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">true</span><span class="p">)</span> <span class="c1"># in sum two times with true</span>

<span class="c1"># Verify will fail because we expect the function `set_process(true)` to be called 3 times but it was only called 2 times</span>
<span class="n">verify</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">true</span><span class="p">)</span>
</code></pre></div></div> <h3 id="verify_no_interactions"> <a href="#verify_no_interactions" class="anchor-heading" aria-labelledby="verify_no_interactions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> verify_no_interactions </h3> <p>Verifies that no interactions happened on the mock.</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">verify_no_interactions</span><span class="p">(</span><span class="o">&lt;</span><span class="n">mock</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div> <p>Here’s an example:</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">mocked_node</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span> <span class="k">as</span> <span class="n">Node</span>

<span class="c1"># Test that we have no initial interactions on this mock</span>
<span class="n">verify_no_interactions</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span>

<span class="c1"># Interact by calling `get_name()`</span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

<span class="c1"># Now this verification will fail because we have interacted on this mock by calling `get_name`</span>
<span class="n">verify_no_interactions</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span>
</code></pre></div></div> <h3 id="verify_no_more_interactions"> <a href="#verify_no_more_interactions" class="anchor-heading" aria-labelledby="verify_no_more_interactions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> verify_no_more_interactions </h3> <p>This method checks if the specified mock has any unverified interactions. If the mock has recorded more interactions than you verified with <strong>verify()</strong>, an error is reported.</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">verify_no_more_interactions</span><span class="p">(</span><span class="o">&lt;</span><span class="n">mock</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div> <p>Here’s an example:</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">mocked_node</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span> <span class="k">as</span> <span class="n">Node</span>

<span class="c1"># Interact on two functions </span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">is_a_parent_of</span><span class="p">(</span><span class="kt">null</span><span class="p">)</span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">false</span><span class="p">)</span>

<span class="c1"># Verify that the mock interacts as expected</span>
<span class="n">verify</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span><span class="o">.</span><span class="n">is_a_parent_of</span><span class="p">(</span><span class="kt">null</span><span class="p">)</span>
<span class="n">verify</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">false</span><span class="p">)</span>

<span class="c1"># Check that there are no further interactions with the mock</span>
<span class="n">verify_no_more_interactions</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span>

<span class="c1"># Simulate an unexpected interaction with `set_process`</span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">false</span><span class="p">)</span>

<span class="c1"># Verify that there are no further interactions with the mock</span>
<span class="c1"># and that the previous unexpected interaction is detected (the test will fail here)</span>
<span class="n">verify_no_more_interactions</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span>
</code></pre></div></div> <p>In this example, the <strong>verify_no_more_interactions()</strong> method is used to check that no more interactions occur after the initial two interactions. The second call to <strong>set_process(false)</strong> is not expected and thus will result in a failure of the test.</p> <h3 id="reset"> <a href="#reset" class="anchor-heading" aria-labelledby="reset"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> reset </h3> <p>Resets the recorded function interactions of the given mock.<br /> Sometimes we want to reuse an already created mock for different test scenarios and have to reset the recorded interactions.</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">reset</span><span class="p">(</span><span class="o">&lt;</span><span class="n">mock</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div> <p>Here’s an example:</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">mocked_node</span> <span class="p">:</span><span class="n">Node</span> <span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span>

<span class="c1"># First, we test by interacting with two functions </span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">is_a_parent_of</span><span class="p">(</span><span class="kt">null</span><span class="p">)</span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">false</span><span class="p">)</span>

<span class="c1"># Verify if the interactions were recorded; at this point, two interactions are recorded</span>
<span class="n">verify</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span><span class="o">.</span><span class="n">is_a_parent_of</span><span class="p">(</span><span class="kt">null</span><span class="p">)</span>
<span class="n">verify</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">false</span><span class="p">)</span>

<span class="c1"># Now, we want to test a different scenario and we need to reset the current recorded interactions</span>
<span class="n">reset</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span>
<span class="c1"># Verify that the previously recorded interactions have been removed</span>
<span class="n">verify_no_more_interactions</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span>

<span class="c1"># Continue testing</span>
<span class="n">mocked_node</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">true</span><span class="p">)</span>
<span class="n">verify</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">true</span><span class="p">)</span>
<span class="n">verify_no_more_interactions</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">)</span>
</code></pre></div></div><hr /> <h2 id="mock-working-modes"> <a href="#mock-working-modes" class="anchor-heading" aria-labelledby="mock-working-modes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mock Working Modes </h2> <p>When creating a mock, you can specify the working mode that defines the return value handling of function calls for a mock.<br /> The available working modes are:</p> <ul> <li> <p><strong>RETURN_DEFAULTS</strong> (default)<br /> This working mode returns default values for functions that have not been stubbed. For example, it returns null for functions that return objects and 0 for functions that return integers. You can use this mode if you only want to test specific interactions with the mock and do not care about the return values of other functions.</p> <p>The default return values for various types are:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Type</th> <th>Default value</th> </tr> </thead> <tbody> <tr> <td>TYPE_NIL</td> <td>null</td> </tr> <tr> <td>TYPE_BOOL</td> <td>false</td> </tr> <tr> <td>TYPE_INT</td> <td>0</td> </tr> <tr> <td>TYPE_REAL</td> <td>0.0</td> </tr> <tr> <td>TYPE_STRING</td> <td>””</td> </tr> <tr> <td>TYPE_VECTOR2</td> <td>Vector2.ZERO</td> </tr> <tr> <td>TYPE_RECT2</td> <td>Rect2()</td> </tr> <tr> <td>TYPE_VECTOR3</td> <td>Vector3.ZERO</td> </tr> <tr> <td>TYPE_TRANSFORM2D</td> <td>Transform2D()</td> </tr> <tr> <td>TYPE_PLANE</td> <td>Plane()</td> </tr> <tr> <td>TYPE_QUAT</td> <td>Quat()</td> </tr> <tr> <td>TYPE_AABB</td> <td>AABB()</td> </tr> <tr> <td>TYPE_BASIS</td> <td>Basis()</td> </tr> <tr> <td>TYPE_TRANSFORM</td> <td>Transform()</td> </tr> <tr> <td>TYPE_COLOR</td> <td>Color()</td> </tr> <tr> <td>TYPE_NODE_PATH</td> <td>NodePath()</td> </tr> <tr> <td>TYPE_RID</td> <td>RID()</td> </tr> <tr> <td>TYPE_OBJECT</td> <td>null</td> </tr> <tr> <td>TYPE_DICTIONARY</td> <td>Dictionary()</td> </tr> <tr> <td>TYPE_ARRAY</td> <td>Array()</td> </tr> <tr> <td>TYPE_RAW_ARRAY</td> <td>PackedByteArray()</td> </tr> <tr> <td>TYPE_INT_ARRAY</td> <td>PackedIntArray()</td> </tr> <tr> <td>TYPE_REAL_ARRAY</td> <td>PackedRealArray()</td> </tr> <tr> <td>TYPE_STRING_ARRAY</td> <td>PackedStringArray()</td> </tr> <tr> <td>TYPE_VECTOR2_ARRAY</td> <td>PackedVector2Array()</td> </tr> <tr> <td>TYPE_VECTOR3_ARRAY</td> <td>PackedVector3Array()</td> </tr> <tr> <td>TYPE_COLOR_ARRAY</td> <td>PackedColorArray()</td> </tr> </tbody> </table></div> <p>You can customize these default values by configuring the mock object to return a different value for unconfigured function calls using the<br /> <code class="language-plaintext highlighter-rouge">when(&lt;mock&gt;).&lt;function&gt;().thenReturn(&lt;value&gt;)</code> method.</p> </li> <li> <p><strong>CALL_REAL_FUNC</strong><br /> This working mode calls the real function implementation instead of returning a default value. You can use this mode if you want to test the interaction between the mock and the real function implementation.</p> </li> <li> <p><strong>RETURN_DEEP_STUB</strong> (not yet implemented!)<br /> This working mode creates a deep stub for the mock object. It returns another mock object for every function call, allowing you to chain function calls on the mock object. You can use this mode if you want to test complex function interactions with the mock.</p> </li> </ul> <p>It’s important to choose the right working mode for your test scenario to ensure that you are testing the intended behavior of the system under test.</p> <p>Here’s an example:</p> <ul id="mock-modes" class="tab" data-tab="5dbd2781-8b6a-45f9-ade6-5f0035aab56d" data-name="mock-modes"> <li class="active" id="mock-modes-return-defaults"> <a href="#">RETURN_DEFAULTS </a> </li> <li id="mock-modes-call-real-func"> <a href="#">CALL_REAL_FUNC </a> </li> <li id="mock-modes-return-deep-stub"> <a href="#">RETURN_DEEP_STUB </a> </li> </ul> <ul class="tab-content" id="5dbd2781-8b6a-45f9-ade6-5f0035aab56d" data-name="mock-modes"> <li class="active"> <p>If <em>RETURN_DEFAULTS</em> is used, all functions will return <a href="/gdUnit4/v6.0.0/advanced_testing/mock/#default-values">default values</a> for a mocked class.</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">mock</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">TestClass</span><span class="p">)</span> <span class="k">as</span> <span class="n">TestClass</span>

<span class="c1"># Returns a default value (for String an empty value)</span>
<span class="n">assert_str</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">message</span><span class="p">())</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
</code></pre></div></div> </li> <li> <p>If <em>CALL_REAL_FUNC</em> is used, all functions will return the value provided by the real implementation for a mocked class. Helpful when you only want to mock partial functions of a class.</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># build a mock with mode CALL_REAL_FUNC</span>
<span class="k">var</span> <span class="n">mock</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">TestClass</span><span class="p">,</span> <span class="n">CALL_REAL_FUNC</span><span class="p">)</span> <span class="k">as</span> <span class="n">TestClass</span>

<span class="c1"># returns the real implementation value</span>
<span class="n">assert_str</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">message</span><span class="p">())</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="s2">"a message"</span><span class="p">)</span>

<span class="c1"># set a the return value to 'custom message' for the function message()</span>
<span class="n">do_return</span><span class="p">(</span><span class="s2">"custom message"</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">mock</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="p">()</span>

<span class="c1"># now the function message will return 'custom message'</span>
<span class="n">assert_str</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">message</span><span class="p">())</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="s2">"custom message"</span><span class="p">)</span>
</code></pre></div></div> </li> <li> <p><strong><em>WORK IN PROGRESS – NOT SUPPORTED YET!!!</em></strong></p> <p>If <em>RETURN_DEEP_STUB</em> is used, all unoverridden function calls return the value provided by the real implementation for a mocked class. Use to return a default value for build-in types or a fully mocked value for Object types.</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># build a mock with mode RETURN_DEEP_STUB</span>
<span class="k">var</span> <span class="n">mock</span> <span class="p">:</span><span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">TestClass</span><span class="p">,</span> <span class="n">RETURN_DEEP_STUB</span><span class="p">)</span> <span class="k">as</span> <span class="n">TestClass</span>

<span class="c1"># returns a default value </span>
<span class="n">assert_str</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">message</span><span class="p">())</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>

<span class="c1"># returns a mocked Path value</span>
<span class="n">assert_object</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">path</span><span class="p">())</span><span class="o">.</span><span class="n">is_not_null</span><span class="p">()</span>
</code></pre></div></div> </li> </ul><hr /> <h2 id="argument-matchers-and-mocks"> <a href="#argument-matchers-and-mocks" class="anchor-heading" aria-labelledby="argument-matchers-and-mocks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Argument Matchers and mocks </h2> <p>Argument matchers allow you to simplify the verification of function calls by verifying function arguments based on their type or class. This is particularly useful when working with mocks because you can use argument matchers to verify function calls without specifying the exact argument values.</p> <p>For example, instead of verifying that a function was called with a specific boolean argument value, you can use the <strong>any_bool()</strong> argument matcher to verify that the function was called with any boolean value. Here’s an example:</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">var</span> <span class="n">mocked_node</span> <span class="p">:</span><span class="n">Node</span> <span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span>
    
    <span class="c1"># Call the function with different arguments</span>
    <span class="n">mocked_node</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">false</span><span class="p">)</span> <span class="c1"># Called 1 time</span>
    <span class="n">mocked_node</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">true</span><span class="p">)</span> <span class="c1"># Called 1 time</span>
    <span class="n">mocked_node</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="bp">true</span><span class="p">)</span> <span class="c1"># Called 2 times</span>
    
    <span class="c1"># Verify that the function was called with any boolean value 3 times</span>
    <span class="n">verify</span><span class="p">(</span><span class="n">mocked_node</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">set_process</span><span class="p">(</span><span class="n">any_bool</span><span class="p">())</span>
</code></pre></div></div> <p>For more details on how to use argument matchers, please see the <a href="/gdUnit4/v6.0.0/advanced_testing/argument_matchers">Argument Matchers</a> section.</p> </main> </div> </div> <footer> <div class="text-small text-grey-dk-100 mb-0"> <p>Copyright &copy; 2021-2025 Mike Schulze. Distributed by an <a href="https://github.com/MikeSchulze/gdUnit4/blob/master/LICENSE">MIT license.</a>.</p> </div> </footer> <div class="search-overlay"></div> </div> <script src="/gdUnit4/v6.0.0/assets/js/tabs.js"></script> <link rel="stylesheet" href="/gdUnit4/v6.0.0/assets/css/tab.css" /> <link rel="stylesheet" href="/gdUnit4/v6.0.0/assets/css/site-header.css" /> <link rel="stylesheet" href="/gdUnit4/v6.0.0/assets/css/site-footer.css" /> </body> </html>
