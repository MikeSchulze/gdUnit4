<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/gdUnit4/v5.0.0/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/gdUnit4/v5.0.0/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul:nth-of-type(5) > li > a, .site-nav > ul:nth-of-type(5) > li > ul > li:not(:nth-child(9)) > a, .site-nav > ul:nth-of-type(5) > li > ul > li > ul > li a { background-image: none; } .site-nav > ul:not(:nth-of-type(5)) a, .site-nav li.external a { background-image: none; } .site-nav > ul:nth-of-type(5) > li:nth-child(1) > ul > li:nth-child(9) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul:nth-of-type(5) > li:nth-child(1) > button svg, .site-nav > ul:nth-of-type(5) > li:nth-child(1) > ul > li:nth-child(9) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul:nth-of-type(5) > li.nav-list-item:nth-child(1) > ul.nav-list, .site-nav > ul:nth-of-type(5) > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(9) > ul.nav-list { display: block; } </style> <script src="/gdUnit4/v5.0.0/assets/js/vendor/lunr.min.js"></script> <script src="/gdUnit4/v5.0.0/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Orphan Nodes | GdUnit4</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Orphan Nodes" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Orphan Nodes or Leaking Memory" /> <meta property="og:description" content="Orphan Nodes or Leaking Memory" /> <meta property="og:site_name" content="GdUnit4" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2025-10-25T09:36:02+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Orphan Nodes" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-10-25T09:36:02+00:00","datePublished":"2025-10-25T09:36:02+00:00","description":"Orphan Nodes or Leaking Memory","headline":"Orphan Nodes","mainEntityOfPage":{"@type":"WebPage","@id":"/gdUnit4/v5.0.0/advanced_testing/orphan/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/gdUnit4/v5.0.0/assets/images/logo.png"}},"url":"/gdUnit4/v5.0.0/advanced_testing/orphan/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/gdUnit4/v5.0.0/" class="site-title lh-tight"><div class="site-logo"> </div> GdUnit4 </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/doc/example.html" class="nav-list-link">Basic Test Example</a></li></ul> <div class="nav-category">First Steps</div> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/first_steps/install/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/first_steps/settings/" class="nav-list-link">Settings</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/first_steps/getting-started/" class="nav-list-link">Getting Started with GDScript Tests</a></li></ul> <div class="nav-category">C# Project Setup</div> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/csharp_project_setup/csharp-setup/" class="nav-list-link">Setup/Installation</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/csharp_project_setup/vstest-adapter/" class="nav-list-link">Configure Your IDE</a></li></ul> <div class="nav-category">Testing</div> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/first-test/" class="nav-list-link">Unit Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/integration-testing/" class="nav-list-link">Integration Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/hooks/" class="nav-list-link">Test Setup/Teardown</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/run-tests/" class="nav-list-link">How To Run Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/skip-tests/" class="nav-list-link">How To Skip Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/flaky-tests/" class="nav-list-link">Flaky Tests</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Asserts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gdUnit4/v5.0.0/testing/assert/" class="nav-list-link">Asserts</a><ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-that/" class="nav-list-link">AssertThat</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-array/" class="nav-list-link">Array Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-bool/" class="nav-list-link">Boolean Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-dictionary/" class="nav-list-link">Dictionary Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-error/" class="nav-list-link">Error/Exception Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-file/" class="nav-list-link">File Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-float/" class="nav-list-link">Float/Double Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-function/" class="nav-list-link">Function/Method Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-integer/" class="nav-list-link">Integer Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-number/" class="nav-list-link">Number Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-object/" class="nav-list-link">Object Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-signal/" class="nav-list-link">Signal Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-string/" class="nav-list-link">String Assert</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/testing/assert-vector/" class="nav-list-link">Vector Assert</a></li></ul></li></ul> <div class="nav-category"></div> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced Testing category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gdUnit4/v5.0.0/advanced_testing/index/" class="nav-list-link">Advanced Testing</a><ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/tools/" class="nav-list-link">Tools and Helpers</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/fuzzing/" class="nav-list-link">Fuzzing</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/paramerized_tests/" class="nav-list-link">Parameterized Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/mock/" class="nav-list-link">Mocking</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/signals/" class="nav-list-link">Signals</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/spy/" class="nav-list-link">Spying</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/argument_matchers/" class="nav-list-link">Argument Matchers</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Scene Runner category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gdUnit4/v5.0.0/advanced_testing/sceneRunner/" class="nav-list-link">Scene Runner</a><ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/scene_runner/actions/" class="nav-list-link">Actions</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/scene_runner/keys/" class="nav-list-link">Key Inputs</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/scene_runner/mouse/" class="nav-list-link">Mouse Inputs</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/scene_runner/touchscreen/" class="nav-list-link">Touchscreen Inputs</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/scene_runner/sync_inputs/" class="nav-list-link">Synchronize Inputs</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/scene_runner/signals/" class="nav-list-link">Signals</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/scene_runner/functions/" class="nav-list-link">Functions</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/scene_runner/accessors/" class="nav-list-link">Accessors</a></li></ul></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/orphan/" class="nav-list-link">Orphan Nodes</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/cmd/" class="nav-list-link">Command Line Tool</a></li></ul></li></ul> <div class="nav-category"></div> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Tutorials category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gdUnit4/v5.0.0/tutorials/index/" class="nav-list-link">Tutorials</a><ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/tutorials/tdd/" class="nav-list-link">Test Driven Development</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/tutorials/scenerunner_examples/" class="nav-list-link">Testing Scene Interactions</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/tutorials/tutorial_basics/" class="nav-list-link">Basics</a></li></ul></li></ul> <div class="nav-category">FAQ</div> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/faq/ci/" class="nav-list-link">Continuous Integration Testing</a></li><li class="nav-list-item"><a href="/gdUnit4/v5.0.0/faq/solutions/" class="nav-list-link">Problems & Solutions</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search GdUnit4" aria-label="Search GdUnit4" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/MikeSchulze/gdUnit4" class="site-button" target="_blank" rel="noopener noreferrer" > GdUnit4 on GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/gdUnit4/v5.0.0/advanced_testing/index/">Advanced Testing</a></li> <li class="breadcrumb-nav-list-item"><span>Orphan Nodes</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="orphan-nodes-or-leaking-memory"> <a href="#orphan-nodes-or-leaking-memory" class="anchor-heading" aria-labelledby="orphan-nodes-or-leaking-memory"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Orphan Nodes or Leaking Memory </h1> <p>When developing in Godot, itâ€™s important to ensure that objects are properly freed, otherwise they become orphan nodes that can lead to memory leaks. This is especially important when writing tests, where you may not know if all objects created during the test have been properly freed.</p> <p>One helpful tool for managing objects is to use the <a href="/gdUnit4/v5.0.0/advanced_testing/tools/#auto_free"><strong>auto_free</strong></a> function.</p><hr /> <h2 id="monitoring"> <a href="#monitoring" class="anchor-heading" aria-labelledby="monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monitoring </h2> <p>GdUnit helps you monitor for orphan nodes by reporting any detected orphan nodes for each test run in the status bar. If no orphan nodes are detected, a green icon is displayed, but if orphan nodes are detected, a red blinking icon warns you.</p> <p><img src="/gdUnit4/v5.0.0/assets/images/monitoring/orphan-nodes.png" alt="orphan-nodes" class="centered" /></p> <p>You can use the button to jump to the first orphan node to inspect it. Orphan nodes are reported and marked in yellow for each test step, including <strong>before()</strong>, <strong>before_test()</strong>, and the test itself.</p> <div class="advice-header"> <img style="vertical-align:middle;" src="/gdUnit4/v5.0.0\assets\images\icons\info-32x32.png" /> <span>Advice</span> <div class="advice-content"> If any orphan nodes are detected, I recommend reviewing your implementation to find and fix the issue. </div> </div><hr /> <h2 id="how-to-fix-detected-orphan-nodes-in-godot"> <a href="#how-to-fix-detected-orphan-nodes-in-godot" class="anchor-heading" aria-labelledby="how-to-fix-detected-orphan-nodes-in-godot"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How to Fix Detected Orphan Nodes in Godot </h2> <p>With GdUnit, you can easily identify orphaned nodes that are marked as WARNING in the GdUnit inspector. It is important to fix any orphaned nodes that are discovered to ensure that your project does not leak memory over time.</p> <h3 id="how-to-recognize-orphan-nodes-in-your-code"> <a href="#how-to-recognize-orphan-nodes-in-your-code" class="anchor-heading" aria-labelledby="how-to-recognize-orphan-nodes-in-your-code"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How to Recognize Orphan Nodes in Your Code </h3> <p>Finding the code location where the orphaned nodes are located can be a little difficult and often time-consuming. If you are not an expert and have no idea what the problem is, we recommend a step-by-step approach to find and fix orphan nodes.</p> <p>Here is a small example of a class with an orphan node:</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class_name</span> <span class="n">TestOrpahnDetection</span>
<span class="k">extends</span> <span class="n">GdUnitTestSuite</span>
<span class="err">@</span><span class="n">warning_ignore</span><span class="p">(</span><span class="s2">'</span><span class="s1">unused_parameter'</span><span class="p">)</span>
<span class="err">@</span><span class="n">warning_ignore</span><span class="p">(</span><span class="s2">'</span><span class="s1">return_value_discarded'</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyClass</span> <span class="k">extends</span> <span class="n">Node</span><span class="p">:</span>
    <span class="k">var</span> <span class="n">orphan_node</span> <span class="o">=</span> <span class="kt">null</span>
    
    <span class="k">func</span> <span class="nf">_init</span><span class="p">():</span>
        <span class="n">orphan_node</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
    
    
    <span class="k">func</span> <span class="nf">test_orphan_detected</span><span class="p">():</span>
        <span class="k">var</span> <span class="n">t</span> <span class="p">:</span><span class="o">=</span> <span class="n">MyClass</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="n">assert_object</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">is_not_null</span><span class="p">()</span>
</code></pre></div></div> <p>When we execute the testcase <code class="language-plaintext highlighter-rouge">test_orphan_detected</code> we will see no failures but it ends with warnings by detect two orphan node.</p> <p><img src="/gdUnit4/v5.0.0/assets/images/monitoring/orphan_nodes_example.png" alt="orphan_nodes_example" /></p> <p>The orphan_node in the class <code class="language-plaintext highlighter-rouge">MyClass</code> is not being used or referenced elsewhere, so it will become an orphan node when the instance of MyClass is destroyed. Also, the instance of <code class="language-plaintext highlighter-rouge">t</code> is referenced elsewhere and is not finally released.</p> <h3 id="how-to-fix-orphan-nodes-step-by-step"> <a href="#how-to-fix-orphan-nodes-step-by-step" class="anchor-heading" aria-labelledby="how-to-fix-orphan-nodes-step-by-step"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How to Fix Orphan Nodes Step by Step </h3> <p><strong>Step One: Fix your Testcase</strong><br /> To fix orphan nodes, it is important to ensure that all nodes used in a test case are covered by the <a href="/gdUnit4/v5.0.0/advanced_testing/tools/#auto_free"><strong>auto_free</strong></a> function. When the test case is finished, <strong>auto_free</strong> will free the instance automatically.</p> <p><strong>auto_free</strong> is a GdUnit function that automatically adds the object to the GdUnit object registry and calls free on the object when the test case ends. This ensures that any nodes created during the test case are cleaned up properly.</p> <p>Here is an example of how to fix the test case from the previous section:</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class_name</span> <span class="n">TestOrpahnDetection</span>
<span class="k">extends</span> <span class="n">GdUnitTestSuite</span>
<span class="err">@</span><span class="n">warning_ignore</span><span class="p">(</span><span class="s2">'</span><span class="s1">unused_parameter'</span><span class="p">)</span>
<span class="err">@</span><span class="n">warning_ignore</span><span class="p">(</span><span class="s2">'</span><span class="s1">return_value_discarded'</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyClass</span> <span class="k">extends</span> <span class="n">Node</span><span class="p">:</span>
<span class="k">var</span> <span class="n">orphan_node</span> <span class="o">=</span> <span class="kt">null</span>

<span class="k">func</span> <span class="nf">_init</span><span class="p">():</span>
    <span class="n">orphan_node</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>


<span class="k">func</span> <span class="nf">test_orphan_detected</span><span class="p">():</span>
    <span class="k">var</span> <span class="n">t</span> <span class="p">:</span><span class="n">MyClass</span> <span class="o">=</span> <span class="n">auto_free</span><span class="p">(</span><span class="n">MyClass</span><span class="o">.</span><span class="n">new</span><span class="p">())</span>
    <span class="n">assert_object</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">is_not_null</span><span class="p">()</span>
</code></pre></div></div> <p>We added the <strong>auto_free</strong> around the instantiation of MyClass to register the automatic release after the test execution.</p> <p>If we run the <code class="language-plaintext highlighter-rouge">test_orphan_detected</code> test case again, we will see that we have fixed an orphaned node, but there is still one present. <img src="/gdUnit4/v5.0.0/assets/images/monitoring/orphan_nodes_example_step2.png" alt="orphan_nodes_example_step2" /></p> <p>The orphan_node in the class <code class="language-plaintext highlighter-rouge">MyClass</code> is not being used or referenced elsewhere, so it will become an orphan node when the instance of MyClass is destroyed.</p> <p><strong>Step Two: Fix the orphan node inside of MyClass</strong><br /> We need to fix the class <code class="language-plaintext highlighter-rouge">MyClass</code> now to ensure the node <code class="language-plaintext highlighter-rouge">orphan_node</code> will be released.<br /> The best way to fix orphan nodes is to ensure that all nodes are added as children of a parent node. When a parent node is freed, all of its child nodes are also freed.</p> <p>Here is an example of how to fix the MyClass example above:</p> <div class="language-gd highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class_name</span> <span class="n">TestOrpahnDetection</span>
<span class="k">extends</span> <span class="n">GdUnitTestSuite</span>
<span class="err">@</span><span class="n">warning_ignore</span><span class="p">(</span><span class="s2">'</span><span class="s1">unused_parameter'</span><span class="p">)</span>
<span class="err">@</span><span class="n">warning_ignore</span><span class="p">(</span><span class="s2">'</span><span class="s1">return_value_discarded'</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyClass</span> <span class="k">extends</span> <span class="n">Node</span><span class="p">:</span>
<span class="k">var</span> <span class="n">orphan_node</span> <span class="o">=</span> <span class="kt">null</span>

<span class="k">func</span> <span class="nf">_init</span><span class="p">():</span>
  <span class="n">orphan_node</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
  <span class="n">add_child</span><span class="p">(</span><span class="n">orphan_node</span><span class="p">)</span>


<span class="k">func</span> <span class="nf">test_orphan_detected</span><span class="p">():</span>
<span class="k">var</span> <span class="n">t</span> <span class="p">:</span><span class="n">MyClass</span> <span class="o">=</span> <span class="n">auto_free</span><span class="p">(</span><span class="n">MyClass</span><span class="o">.</span><span class="n">new</span><span class="p">())</span>
<span class="n">assert_object</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">is_not_null</span><span class="p">()</span>
</code></pre></div></div> <p>In this fixed version of MyClass, the orphan_node is added as a child of a parent_node. When the instance of MyClass is destroyed, the parent_node and orphan_node will also be freed.</p> <p>Rerun your test and you see the orpahn nodes is fixed. <img src="/gdUnit4/v5.0.0/assets/images/monitoring/orphan_nodes_example_step2.png" alt="orphan_nodes_example_step2" /></p> </main> </div> </div> <footer> <div class="text-small text-grey-dk-100 mb-0"> <p>Copyright &copy; 2021-2025 Mike Schulze. Distributed by an <a href="https://github.com/MikeSchulze/gdUnit4/blob/master/LICENSE">MIT license.</a>.</p> </div> </footer> <div class="search-overlay"></div> </div> <script src="/gdUnit4/v5.0.0/assets/js/tabs.js"></script> <link rel="stylesheet" href="/gdUnit4/v5.0.0/assets/css/tab.css" /> <link rel="stylesheet" href="/gdUnit4/v5.0.0/assets/css/site-header.css" /> </body> </html>
