<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/gdUnit4/assets/css/just-the-docs-default.css"> <script src="/gdUnit4/assets/js/vendor/lunr.min.js"></script> <script src="/gdUnit4/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Orphan Nodes | GdUnit4</title> <meta name="generator" content="Jekyll v3.9.3" /> <meta property="og:title" content="Orphan Nodes" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Orphan Nodes or Leaking Memory When developing in Godot, it’s important to ensure that objects are properly freed, otherwise they become orphan nodes that can lead to memory leaks. This is especially important when writing tests, where you may not know if all objects created during the test have been properly freed." /> <meta property="og:description" content="Orphan Nodes or Leaking Memory When developing in Godot, it’s important to ensure that objects are properly freed, otherwise they become orphan nodes that can lead to memory leaks. This is especially important when writing tests, where you may not know if all objects created during the test have been properly freed." /> <meta property="og:site_name" content="GdUnit4" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Orphan Nodes" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Orphan Nodes or Leaking Memory When developing in Godot, it’s important to ensure that objects are properly freed, otherwise they become orphan nodes that can lead to memory leaks. This is especially important when writing tests, where you may not know if all objects created during the test have been properly freed.","headline":"Orphan Nodes","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/gdUnit4/assets/images/logo.png"}},"url":"/gdUnit4/advanced_testing/orphan/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path> <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle> <line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line> <line x1="3" y1="6" x2="21" y2="6"></line> <line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path> <polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/gdUnit4/" class="site-title lh-tight"><div class="site-logo"></div> GdUnit4</a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"> <use xlink:href="#svg-menu"></use> </svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <div class="nav-category">First Steps</div> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/first_steps/install/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/gdUnit4/first_steps/settings/" class="nav-list-link">Settings</a></li><li class="nav-list-item"><a href="/gdUnit4/first_steps/firstTest/" class="nav-list-link">Create Your First Test</a></li></ul> <div class="nav-category"></div> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Asserts category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/gdUnit4/asserts/index/" class="nav-list-link">Asserts</a><ul class="nav-list"><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-string/" class="nav-list-link">String Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-bool/" class="nav-list-link">Boolean Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-integer/" class="nav-list-link">Integer Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-number/" class="nav-list-link">Number Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-float/" class="nav-list-link">Float/Double Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-array/" class="nav-list-link">Array Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-dictionary/" class="nav-list-link">Dictionary Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-object/" class="nav-list-link">Object Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-vector/" class="nav-list-link">Vector Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-file/" class="nav-list-link">File Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-function/" class="nav-list-link">Function/Method Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-signal/" class="nav-list-link">Signal Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-error/" class="nav-list-link">Error Assert</a></li><li class="nav-list-item "><a href="/gdUnit4/asserts/assert-that/" class="nav-list-link">AssertThat</a></li></ul></li></ul> <div class="nav-category"></div> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Advanced Testing category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/gdUnit4/advanced_testing/index/" class="nav-list-link">Advanced Testing</a><ul class="nav-list"><li class="nav-list-item "><a href="/gdUnit4/advanced_testing/tools/" class="nav-list-link">Tools and Helpers</a></li><li class="nav-list-item "><a href="/gdUnit4/advanced_testing/fuzzing/" class="nav-list-link">Fuzzing</a></li><li class="nav-list-item "><a href="/gdUnit4/advanced_testing/paramerized_tests/" class="nav-list-link">Parameterized Tests</a></li><li class="nav-list-item "><a href="/gdUnit4/advanced_testing/mock/" class="nav-list-link">Mocking</a></li><li class="nav-list-item "><a href="/gdUnit4/advanced_testing/signals/" class="nav-list-link">Signals</a></li><li class="nav-list-item "><a href="/gdUnit4/advanced_testing/spy/" class="nav-list-link">Spying</a></li><li class="nav-list-item "><a href="/gdUnit4/advanced_testing/argument_matchers/" class="nav-list-link">Argument Matchers</a></li><li class="nav-list-item "><a href="/gdUnit4/advanced_testing/sceneRunner/" class="nav-list-link">Scene Runner</a></li><li class="nav-list-item active"><a href="/gdUnit4/advanced_testing/orphan/" class="nav-list-link active">Orphan Nodes</a></li><li class="nav-list-item "><a href="/gdUnit4/advanced_testing/cmd/" class="nav-list-link">Command Line Tool</a></li></ul></li></ul> <div class="nav-category"></div> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Tutorials category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/gdUnit4/tutorials/index/" class="nav-list-link">Tutorials</a><ul class="nav-list"><li class="nav-list-item "><a href="/gdUnit4/tutorials/tdd/" class="nav-list-link">Test Driven Development</a></li><li class="nav-list-item "><a href="/gdUnit4/tutorials/scenerunner_examples/" class="nav-list-link">Testing Scene Interactions</a></li><li class="nav-list-item "><a href="/gdUnit4/tutorials/tutorial_basics/" class="nav-list-link">Basics</a></li></ul></li></ul> <div class="nav-category">FAQ</div> <ul class="nav-list"><li class="nav-list-item"><a href="/gdUnit4/faq/inspector/" class="nav-list-link">Inspector</a></li><li class="nav-list-item"><a href="/gdUnit4/faq/run-tests/" class="nav-list-link">How To Run Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/faq/skip-tests/" class="nav-list-link">How To Skip Tests</a></li><li class="nav-list-item"><a href="/gdUnit4/faq/test-case/" class="nav-list-link">TestCase</a></li><li class="nav-list-item"><a href="/gdUnit4/faq/test-suite/" class="nav-list-link">TestSuite</a></li><li class="nav-list-item"><a href="/gdUnit4/faq/C%23/" class="nav-list-link">C# Support</a></li><li class="nav-list-item"><a href="/gdUnit4/faq/ci/" class="nav-list-link">Continuous Integration Testing</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search GdUnit4" aria-label="Search GdUnit4" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"> <use xlink:href="#svg-search"></use> </svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/MikeSchulze/gdUnit4" class="site-button" target="_blank" rel="noopener noreferrer" > GdUnit4 on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">Advanced Testing</a></li> <li class="breadcrumb-nav-list-item"><span>Orphan Nodes</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="orphan-nodes-or-leaking-memory"> <a href="#orphan-nodes-or-leaking-memory" class="anchor-heading" aria-labelledby="orphan-nodes-or-leaking-memory"><svg viewBox="0 0 16 16" aria-hidden="true"> <use xlink:href="#svg-link"></use> </svg></a> Orphan Nodes or Leaking Memory </h1> <p>When developing in Godot, it’s important to ensure that objects are properly freed, otherwise they become orphan nodes that can lead to memory leaks. This is especially important when writing tests, where you may not know if all objects created during the test have been properly freed.</p> <p>One helpful tool for managing objects is to use the <a href="/gdUnit4/advanced_testing/tools/#auto_free"><strong>auto_free</strong></a> function.</p><hr /> <h2 id="monitoring"> <a href="#monitoring" class="anchor-heading" aria-labelledby="monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"> <use xlink:href="#svg-link"></use> </svg></a> Monitoring </h2> <p>GdUnit helps you monitor for orphan nodes by reporting any detected orphan nodes for each test run in the status bar. If no orphan nodes are detected, a green icon is displayed, but if orphan nodes are detected, a red blinking icon warns you.</p> <p><img src="/gdUnit4/assets/images/monitoring/orphan-nodes.png" alt="" class="centered" /></p> <p>You can use the button to jump to the first orphan node to inspect it. Orphan nodes are reported and marked in yellow for each test step, including <strong>before()</strong>, <strong>before_test()</strong>, and the test itself.</p> <div class="advice-header"> <img style="vertical-align:middle;" src="\gdUnit4\assets\images\icons\info-32x32.png" /> <span>Advice</span> <div class="advice-content"> If any orphan nodes are detected, I recommend reviewing your implementation to find and fix the issue. </div> </div><hr /> <h2 id="how-to-fix-detected-orphan-nodes-in-godot"> <a href="#how-to-fix-detected-orphan-nodes-in-godot" class="anchor-heading" aria-labelledby="how-to-fix-detected-orphan-nodes-in-godot"><svg viewBox="0 0 16 16" aria-hidden="true"> <use xlink:href="#svg-link"></use> </svg></a> How to Fix Detected Orphan Nodes in Godot </h2> <p>With GdUnit, you can easily identify orphaned nodes that are marked as WARNING in the GdUnit inspector. It is important to fix any orphaned nodes that are discovered to ensure that your project does not leak memory over time.</p> <h3 id="how-to-recognize-orphan-nodes-in-your-code"> <a href="#how-to-recognize-orphan-nodes-in-your-code" class="anchor-heading" aria-labelledby="how-to-recognize-orphan-nodes-in-your-code"><svg viewBox="0 0 16 16" aria-hidden="true"> <use xlink:href="#svg-link"></use> </svg></a> How to Recognize Orphan Nodes in Your Code </h3> <p>Finding the code location where the orphaned nodes are located can be a little difficult and often time-consuming. If you are not an expert and have no idea what the problem is, we recommend a step-by-step approach to find and fix orphan nodes.</p> <p>Here is a small example of a class with an orphan node:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">class_name</span> <span class="no">TestOrpahnDetection</span>
  <span class="n">extends</span> <span class="no">GdUnitTestSuite</span>
  <span class="vi">@warning_ignore</span><span class="p">(</span><span class="s1">'unused_parameter'</span><span class="p">)</span>
  <span class="vi">@warning_ignore</span><span class="p">(</span><span class="s1">'return_value_discarded'</span><span class="p">)</span>


  <span class="k">class</span> <span class="nc">MyClass</span> <span class="n">extends</span> <span class="no">Node</span><span class="p">:</span>
    <span class="n">var</span> <span class="n">orphan_node</span> <span class="o">=</span> <span class="n">null</span>
    
    <span class="n">func</span> <span class="n">_init</span><span class="p">():</span>
      <span class="n">orphan_node</span> <span class="o">=</span> <span class="no">Node</span><span class="p">.</span><span class="nf">new</span><span class="p">()</span>


  <span class="n">func</span> <span class="n">test_orphan_detected</span><span class="p">():</span>
    <span class="n">var</span> <span class="n">t</span> <span class="p">:</span><span class="o">=</span> <span class="no">MyClass</span><span class="p">.</span><span class="nf">new</span><span class="p">()</span>
    <span class="n">assert_object</span><span class="p">(</span><span class="n">t</span><span class="p">).</span><span class="nf">is_not_null</span><span class="p">()</span>
</code></pre></div></div> <p>When we execute the testcase <code class="language-plaintext highlighter-rouge">test_orphan_detected</code> we will see no failures but it ends with warnings by detect two orphan node.</p> <p><img src="/gdUnit4/assets/images/monitoring/orphan_nodes_example.png" alt="" /></p> <p>The orphan_node in the class <code class="language-plaintext highlighter-rouge">MyClass</code> is not being used or referenced elsewhere, so it will become an orphan node when the instance of MyClass is destroyed. Also, the instance of <code class="language-plaintext highlighter-rouge">t</code> is referenced elsewhere and is not finally released.</p> <h3 id="how-to-fix-orphan-nodes-step-by-step"> <a href="#how-to-fix-orphan-nodes-step-by-step" class="anchor-heading" aria-labelledby="how-to-fix-orphan-nodes-step-by-step"><svg viewBox="0 0 16 16" aria-hidden="true"> <use xlink:href="#svg-link"></use> </svg></a> How to Fix Orphan Nodes Step by Step </h3> <p><strong>Step One: Fix your Testcase</strong><br /> To fix orphan nodes, it is important to ensure that all nodes used in a test case are covered by the <a href="/gdUnit4/advanced_testing/tools/#auto_free"><strong>auto_free</strong></a> function. When the test case is finished, <strong>auto_free</strong> will free the instance automatically.</p> <p><strong>auto_free</strong> is a GdUnit function that automatically adds the object to the GdUnit object registry and calls free on the object when the test case ends. This ensures that any nodes created during the test case are cleaned up properly.</p> <p>Here is an example of how to fix the test case from the previous section:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">class_name</span> <span class="no">TestOrpahnDetection</span>
  <span class="n">extends</span> <span class="no">GdUnitTestSuite</span>
  <span class="vi">@warning_ignore</span><span class="p">(</span><span class="s1">'unused_parameter'</span><span class="p">)</span>
  <span class="vi">@warning_ignore</span><span class="p">(</span><span class="s1">'return_value_discarded'</span><span class="p">)</span>


  <span class="k">class</span> <span class="nc">MyClass</span> <span class="n">extends</span> <span class="no">Node</span><span class="p">:</span>
    <span class="n">var</span> <span class="n">orphan_node</span> <span class="o">=</span> <span class="n">null</span>
    
    <span class="n">func</span> <span class="n">_init</span><span class="p">():</span>
      <span class="n">orphan_node</span> <span class="o">=</span> <span class="no">Node</span><span class="p">.</span><span class="nf">new</span><span class="p">()</span>


  <span class="n">func</span> <span class="n">test_orphan_detected</span><span class="p">():</span>
    <span class="n">var</span> <span class="n">t</span> <span class="ss">:MyClass</span> <span class="o">=</span> <span class="n">auto_free</span><span class="p">(</span><span class="no">MyClass</span><span class="p">.</span><span class="nf">new</span><span class="p">())</span>
    <span class="n">assert_object</span><span class="p">(</span><span class="n">t</span><span class="p">).</span><span class="nf">is_not_null</span><span class="p">()</span>
</code></pre></div></div> <p>We added the <strong>auto_free</strong> around the instantiation of MyClass to register the automatic release after the test execution.</p> <p>If we run the <code class="language-plaintext highlighter-rouge">test_orphan_detected</code> test case again, we will see that we have fixed an orphaned node, but there is still one present. <img src="/gdUnit4/assets/images/monitoring/orphan_nodes_example_step2.png" alt="" /></p> <p>The orphan_node in the class <code class="language-plaintext highlighter-rouge">MyClass</code> is not being used or referenced elsewhere, so it will become an orphan node when the instance of MyClass is destroyed.</p> <p><strong>Step Two: Fix the orphan node inside of MyClass</strong><br /> We need to fix the class <code class="language-plaintext highlighter-rouge">MyClass</code> now to ensure the node <code class="language-plaintext highlighter-rouge">orphan_node</code> will be released.<br /> The best way to fix orphan nodes is to ensure that all nodes are added as children of a parent node. When a parent node is freed, all of its child nodes are also freed.</p> <p>Here is an example of how to fix the MyClass example above:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">class_name</span> <span class="no">TestOrpahnDetection</span>
  <span class="n">extends</span> <span class="no">GdUnitTestSuite</span>
  <span class="vi">@warning_ignore</span><span class="p">(</span><span class="s1">'unused_parameter'</span><span class="p">)</span>
  <span class="vi">@warning_ignore</span><span class="p">(</span><span class="s1">'return_value_discarded'</span><span class="p">)</span>


  <span class="k">class</span> <span class="nc">MyClass</span> <span class="n">extends</span> <span class="no">Node</span><span class="p">:</span>
    <span class="n">var</span> <span class="n">orphan_node</span> <span class="o">=</span> <span class="n">null</span>
    
    <span class="n">func</span> <span class="n">_init</span><span class="p">():</span>
      <span class="n">orphan_node</span> <span class="o">=</span> <span class="no">Node</span><span class="p">.</span><span class="nf">new</span><span class="p">()</span>
      <span class="n">add_child</span><span class="p">(</span><span class="n">orphan_node</span><span class="p">)</span>


  <span class="n">func</span> <span class="n">test_orphan_detected</span><span class="p">():</span>
    <span class="n">var</span> <span class="n">t</span> <span class="ss">:MyClass</span> <span class="o">=</span> <span class="n">auto_free</span><span class="p">(</span><span class="no">MyClass</span><span class="p">.</span><span class="nf">new</span><span class="p">())</span>
    <span class="n">assert_object</span><span class="p">(</span><span class="n">t</span><span class="p">).</span><span class="nf">is_not_null</span><span class="p">()</span>
</code></pre></div></div> <p>In this fixed version of MyClass, the orphan_node is added as a child of a parent_node. When the instance of MyClass is destroyed, the parent_node and orphan_node will also be freed.</p> <p>Rerun your test and you see the orpahn nodes is fixed. <img src="/gdUnit4/assets/images/monitoring/orphan_nodes_example_step2.png" alt="" /></p><hr /> <h4> <a href="#how-to-fix-orphan-nodes-step-by-step" class="anchor-heading" aria-labelledby="how-to-fix-orphan-nodes-step-by-step"><svg viewBox="0 0 16 16" aria-hidden="true"> <use xlink:href="#svg-link"></use> </svg></a> document version v4.1.0 </h4> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2021-2023 Mike Schulze. Distributed by an <a href="https://github.com/MikeSchulze/gdUnit4/blob/master/LICENSE">MIT license.</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> <script src="/gdUnit4/assets/js/tabs.js"></script> <link rel="stylesheet" href="/gdUnit4/assets/css/tab.css" /> <link rel="stylesheet" href="/gdUnit4/assets/css/site-header.css" /> </body> </html>
